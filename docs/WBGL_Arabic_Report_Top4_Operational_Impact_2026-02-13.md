# تقرير عربي تشغيلي — شرح أول 4 ملاحظات حرجة وتأثيرها على العمل اليومي

التاريخ: 2026-02-13  
المرجع: النقاط الأربع الأولى من تقرير التدقيق التشغيلي الحالي  
افتراض التشغيل: جهاز واحد محلي، مستخدم واحد، عمل يومي يدوي

---

## 1) تضارب مصدر التنقل والسجل (Navigation vs Record Source)

### ماذا تعني المشكلة
هناك مساران مختلفان لتحديد السجل الحالي:
- مسار يعتمد الفهرس مع ترتيب زمني تنازلي.
- مسار يعتمد خدمة تنقل مرتبطة بالفلترة والحالة.

عند اختلاف المسارين، قد تعرض الواجهة سجلًا بينما يعرض Timeline سجلًا آخر، أو تنتقل عملية الحفظ إلى سجل غير المتوقع.


### التأثير على العمل اليومي
- فقدان الثقة في الشاشة الحالية: المستخدم يعتقد أنه يعمل على ضمان معين بينما النظام مرتبط فعليًا بضمان آخر.
- أخطاء متابعة: ملاحظة أو قرار قد يرتبط بسجل غير المقصود.
- زيادة وقت المراجعة لأن المستخدم يعيد التدقيق يدويًا بعد كل خطوة.

### سيناريو تضارب واقعي
1. المستخدم يفتح النظام مع فلتر حالة معين.
2. واجهة التنقل تنتقل وفق منطق الفلتر.
3. Timeline يحمّل بناء على فهرس مختلف.
4. المستخدم يقرأ التاريخ ويستنتج قرارًا اعتمادًا على Timeline غير المطابق للسجل المعروض.

النتيجة: قرار صحيح لكن على سياق خاطئ.

### مثال تشغيلي
- المستخدم يشاهد ضمان رقم A في الفورم.
- Timeline المعروض يعود للضمان B (بسبب اختلاف ترتيب/فهرسة).
- المستخدم يغيّر المورد معتقدًا أنه يصلح A، بينما القرار مرتبط بمسار B في القراءة التشغيلية.

### مؤشرات ظهور المشكلة
- تغيّر رقم الضمان في بعض الطلبات الخلفية بدون ملاحظة المستخدم.
- أحداث Timeline لا تتطابق مع البيانات الحالية في الفورم.
- شكاوى من نوع: لماذا يظهر تاريخ لا يخص هذا السجل؟

---
تعليق المالك :
"
أظن هذا حدث بسبب انني كنت اود الاستفاده من التنقل (التالي / السابق ) حتى لو تم اختيار فلتر معين 
المشكله فعلا تحتاج لحل ولاكن مع عدم كسر لفائدة الفلتره والتنقل بداخلها او خارج الفلتره
"
---

## 2) تعطل بنية الاختبارات (PHPUnit غير قابل للتشغيل)

### ماذا تعني المشكلة
بيئة الاختبار لا تعمل حاليًا، لذلك أي تعديل برمجي يعتمد على فحص يدوي فقط.

### التأثير على العمل اليومي
- في التشغيل اليومي المباشر التأثير محدود ظاهريًا.
- لكن عند أي تعديل سريع أو إصلاح عاجل، ترتفع احتمالية ظهور أثر جانبي في مسار آخر بدون اكتشاف مبكر.

### سيناريو تضارب واقعي
1. تم إصلاح مشكلة في حفظ القرار.
2. لا توجد اختبارات تعمل للتحقق من التنقل أو Timeline بعد الإصلاح.
3. بعد يومين تظهر مشكلة جديدة في خطوة لم تكن ضمن الإصلاح.

النتيجة: دورة إصلاح متكررة وتكلفة زمنية أعلى حتى في بيئة مستخدم واحد.

### مثال تشغيلي
- تعديل بسيط في API يعالج خطأ إدخال.
- لاحقًا يتعطل عداد السجل الحالي أو الانتقال للسجل التالي.
- السبب ليس التعديل المقصود، بل أثر جانبي لم يتم كشفه مبكرًا بسبب غياب الاختبارات القابلة للتنفيذ.

### مؤشرات ظهور المشكلة
- تكرار جملة: أصلحنا نقطة وانكسرت نقطة أخرى.
- الاعتماد الكامل على اختبار يدوي بعد كل تغيير.

---

تعليق المالك :
"
يجب اصلاحها ولكن لا اريد تكرار ماهو موجود
C:\Users\Bakheet\Documents\WBGL\phpunit.xml

"
---

## 3) الاعتماد على global db في تقييم الحالة

### ماذا تعني المشكلة
دالة تقييم الحالة تعتمد على متغير عام غير صريح. إذا تم استدعاؤها خارج سياق يحقن هذا المتغير، قد تتصرف بشكل غير متوقع أو تفشل.

### التأثير على العمل اليومي
- في المسارات الحالية قد تعمل غالبًا لأن السياق متوفر.
- لكن أي استدعاء جديد (سكربت صيانة، مهمة جانبية، API جديد) قد يعطي نتائج حالة غير صحيحة.

### سيناريو تضارب واقعي
1. إضافة نقطة API جديدة تستخدم تقييم الحالة.
2. النقطة الجديدة لا تهيئ المتغير العام بنفس طريقة صفحة الويب.
3. تقييم الحالة يرجع pending رغم اكتمال البيانات أو يفشل صامتًا.

النتيجة: تضارب بين ما يراه المستخدم في شاشة وما تقرره خدمة أخرى.

### مثال تشغيلي
- سجل لديه بنك ومورد كاملان.
- شاشة تعرض ready، لكن خدمة أخرى تعتمد على نفس evaluator ترجع pending.
- تظهر تعارضات مثل منع إجراء كان يجب السماح به.

### مؤشرات ظهور المشكلة
- نفس السجل يأخذ حالتين مختلفتين بين صفحتين/خدمتين.
- أخطاء تظهر فقط في بعض المسارات وليس كلها.

---
تعليق المالك :
"
يجب اصلاحها بما لا يتناقض مع المنطق الحالي والذي يظهر في الشاشه كما ذكرت

"
---

## 4) بقاء استعلامات تحقق بصيغة interpolation

### ماذا تعني المشكلة
بعض استعلامات التحقق تبني SQL بدمج القيمة داخل النص مباشرة بدل التمرير المهيأ الكامل.

### التأثير على العمل اليومي
- في نموذجك الحالي (مدخلات محلية ومستخدم واحد) الخطر الأمني المباشر منخفض.
- لكن هذه الصيغة ترفع قابلية ظهور أخطاء صيانة أو اختلاف سلوك عند أي تغيير مستقبلي في نوع البيانات أو طريقة الإدخال.

### سيناريو تضارب واقعي
1. تحديث مستقبلي يغير طريقة قراءة المعرفات أو نوعها.
2. استعلامات مهيأة تعمل طبيعيًا، بينما استعلام interpolation يبدأ بإرجاع نتائج غير متوقعة.
3. عمليات التحقق بعد التعديل تعطي رسائل متناقضة.

النتيجة: تضارب في رسائل النجاح/الفشل يصعب تتبعه.

### مثال تشغيلي
- المستخدم يعدل بنكًا بنجاح.
- خطوة التحقق اللاحقة ترجع نتيجة غير متسقة بسبب نمط الاستعلام.
- تظهر رسالة خطأ رغم أن التعديل تم، أو العكس.

### مؤشرات ظهور المشكلة
- تناقض بين rowCount ونتيجة التحقق النهائي.
- حالات نادرة متقطعة يصعب إعادة إنتاجها.

---
تعليق المالك :
"
اصلحها بما لا يسبب مشكله في سلوك التحقق الحالي

"
---

## الخلاصة التشغيلية المختصرة

- النقطة 1 هي الأكثر تأثيرًا على صحة القرار اليومي لأنها تمس السجل المعروض نفسه.
- النقطة 2 لا توقف التشغيل اليومي فورًا لكنها تزيد تكلفة أي تعديل مستقبلي.
- النقطة 3 مصدر تضارب منطقي عند التوسع البسيط أو إضافة مسارات جديدة.
- النقطة 4 ليست أولوية أمنية في نموذجك الحالي، لكنها أولوية جودة واتساق برمجي.

---

## ترتيب أولوية عملي مقترح (لهذا النموذج التشغيلي)

1. توحيد مرجعية السجل والتنقل (النقطة 1).
2. إزالة الاعتماد على global db في تقييم الحالة (النقطة 3).
3. توحيد استعلامات التحقق إلى Prepared Statements (النقطة 4).
4. إصلاح قابلية تشغيل الاختبارات عند أول نافذة تطوير مناسبة (النقطة 2).
