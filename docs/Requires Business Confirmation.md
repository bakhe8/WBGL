# طلبات تأكيد الأعمال (Business Confirmation)
النقاط التالية تتطلب تأكيدًا صريحًا من جهة الأعمال (Business Owner / Process Owner) قبل اعتماد التصميم النهائي أو بدء التنفيذ، حيث أن أي افتراض تقني فيها قد يؤدي إلى سلوك غير مقصود أو تعارض تشغيلي/قانوني.

1️⃣ Lifecycle & Governance

هل العلاقة بين State و Stage:

متوازية ومستقلة؟
**إجابة**: هما مساران متوازيان. `State` (pending/ready/released) يعبر عن اكتمال البيانات فنياً، و `Stage` يعبر عن التقدم الإداري (Draft -> Signed).

أم أن Stage لا يمكن أن يتقدم إلا ضمن State محدد؟
**إجابة**: نعم، الـ `Stage` يعتمد على الـ `State`؛ حيث لا يمكن تجاوز مرحلة `Draft` (التدقيق) تقنياً إلا إذا كانت حالة القرار هي `ready`.

متى يتم الانتقال الرسمي من pending إلى ready؟

تلقائيًا بعد المطابقة؟
**إجابة**: نعم، يتم الانتقال تلقائياً (Auto-match) إذا توفرت بيانات المورد والبنك بدقة كافية (>90% للمورد ومطابقة مباشرة للبنك).

أم بعد إجراء بشري (Audit / Analyze)؟
**إجابة**: أو يدوياً عند قيام الموظف بحفظ السجل بعد اختيار المورد والبنك بشكل صحيح.

هل جميع مراحل الموافقة
(audited → analyzed → supervised → approved → signed)
إلزامية لكل ضمان، أم يمكن تجاوز بعض المراحل حسب:

نوع الضمان؟
قيمة الضمان؟
سياسة داخلية؟
**إجابة**: المراحل الست إلزامية حالياً في الكود وتتبع تسلسلاً ثابتاً (`WorkflowService.php`). لا يوجد منطق برمجى حالي لتجاوز مراحل بناءً على القيمة أو النوع.

2️⃣ Roles & Authority

هل دور Admin:

إداري تقني فقط؟
أم يملك صلاحيات تشغيلية (Audit / Approve / Sign)؟
**إجابة**: دور الـ Admin برمجياً هو دور إداري وصلاحياته تعتمد على ما يتم منحه له في جدول الصلاحيات. يمكن منح الـ Admin صلاحيات تشغيلية تماماً كأي مستخدم آخر.

في حال امتلاك Admin لصلاحيات تشغيلية:

هل هذا مسموح دائمًا؟
**إجابة**: نعم مسموح دائماً إذا كانت الصلاحية ممنوحة للدور في قاعدة البيانات.

أم فقط كـ Break-glass scenario مع تسجيل سبب إلزامي؟
**إجابة**: لا يوجد نظام "كسر الزجاج" (Break-glass) يطلب سبباً إلزاميًا في المسار الطبيعي حالياً.

من هو الدور المخوّل رسميًا بـ Confirm Audit؟

Auditor فقط؟
أم أكثر من دور؟
**إجابة**: أي مستخدم يملك صلاحية `audit_data`. عادة ما يكون هذا دور `Auditor` ولكن النظام يسمح بمنحها لأدوار أخرى.

3️⃣ Matching & Machine Learning

ما هو المسار الرسمي لحالات المطابقة التي تقع بين
70% و 95% ثقة؟

مراجعة إلزامية دائمًا؟
**إجابة**: العتبة الحالية في الكود هي 90%. أي ضمان ثقته أقل من 90% (بما في ذلك نطاق 70-90) يمنع النظام من اعتماده تلقائياً ويضعه في قائمة الانتظار للمدقق البشري.

أم يمكن قبولها تلقائيًا بشروط؟
**إجابة**: لا تُقبل تلقائياً حالياً إذا كانت أقل من 90%، إلا إذا توافقت مع نمط مؤكد بنسبة 100%.

من يملك الحق في:

تأكيد Pattern؟
فرض Penalty؟
نسيان Pattern؟
**إجابة**: حالياً، أي مستخدم يملك صلاحية حفظ القرار (Manual Override) يساهم مباشرة في "التعلم". لا يوجد فصل حالي بين الأدوار في تعليم النظام.

هل تأثير التعلم الآلي:

فوري عند كل تدخل بشري؟
**إجابة**: نعم، التأثير فوري عند حفظ القرار اليدوي (`DecisionService::save`).

أم خاضع لمراجعة/تجميع قبل اعتماده؟
**إجابة**: لا يوجد مرحلة مراجعة للتعلم حالياً؛ القرار البشري المباشر يعلّم النظام فوراً.

4️⃣ Event Review & Audit Trail

ما هو التعريف التجاري لـ Event Review؟

عرض بصري فقط؟
أم إعادة بناء حالة الضمان كما كانت فعليًا؟
**إجابة**: هو إعادة بناء كاملة. نظام الـ `Snapshot` يلتقط نسخة كاملة من بيانات الضمان عند كل حدث، مما يسمح بعرض حالته كما كانت تماماً في تاريخ الحدث.

هل مسموح:

بتصدير حالة Event Review؟
باستخدامها كمرجع رسمي/تدقيقي؟
**إجابة**: الكود ينشئ لقطات HTML للخطابات (`letter_snapshot`) عند كل حدث لتكون مرجعاً تدقيقياً ثابتاً وغير قابل للتغيير.

هل يمكن تعديل أو إخفاء أو تصحيح Event في Timeline؟

وإن كان نعم: من؟ وبأي ضوابط؟
**إجابة**: غير مسموح برمجياً. لا توجد واجهة لتعديل السجلات التاريخية في لوحة التحكم، والبيانات تعتبر مرجعاً غير قابل للمس.

5️⃣ Batches & Imports

عند إعادة فتح دفعة مغلقة:

هل يؤثر ذلك على الضمانات التابعة؟
**إجابة**: لا يؤثر على البيانات الحالية للضمانات التابعة، بل يسمح فقط بتنفيذ إجراءات جماعية جديدة عليها (تمديد/إفراج جماعي).

هل يعاد احتساب المؤشرات والتحليلات؟
**إجابة**: المؤشرات (Stats) في النظام يتم استدعاؤها لحظياً من قاعدة البيانات (`StatsService.php`)؛ لذا فهي تعكس الحالة الراهنة دائماً سواء كانت الدفعة مغلقة أو مفتوحة.

من يملك صلاحية إعادة فتح الدفعة؟

Admin؟
Role محدد؟
مع سبب إلزامي؟
**إجابة**: الصلاحية حالياً مفتوحة لمستخدمي واجهة الدفعات. لا يطلب النظام سبباً إلزامياً موثقاً في الكود البرمجي لحركة إعادة فتح الدفعة.

كيف يُتعامل مع ضمان مكرر عبر دفعات مختلفة؟

منع؟
قبول مع وسم Duplicate؟
دمج؟
**إجابة**: يتم قبوله مع تسجيل حدث "استيراد مكرر" (`duplicate_import`) في سجل الضمان للتوضيح، ولا يتم استبدال البيانات السابقة آلياً للتأكد من مراجعة الحالتين.

6️⃣ Data Intake Priority

ما هي أولوية الثقة بين مصادر الإدخال؟

Excel
Smart Paste
Manual Entry
**إجابة**: القرار البشري (`Manual`) دائماً له الأولوية القصوى.

هل Smart Paste:

يخضع لنفس مراحل التدقيق والموافقة؟
**إجابة**: نعم، يخضع تماماً لنفس المسار الرسمي للتدقيق والموافقة.

أم يُعد مسارًا مخففًا؟
**إجابة**: لا يعد مساراً مخففاً؛ بل مجرد قناة إدخال ذكية تنتهي في طابور العمل العادي.

7️⃣ Operational Actions

هل تخفيض الضمان:

إجراء نهائي؟
**إجابة**: برمجياً هو تعديل مباشر على القيمة الحالية.

أم يمكن التراجع عنه؟
**إجابة**: لا يوجد زر "تراجع" (Undo) خاص؛ التراجع يتم عبر إجراء تعديل يدوي آخر لتصحيح القيمة.

ما الفرق التجاري بين:

Vacate (إفراغ)
Release (إفراج)
وهل أحدهما يؤدي تلقائيًا للآخر؟
**إجابة**: الـ `Release` هو الإجراء الرسمي للانتهاء. مصطلح `Vacate` غير مستخدم كحالة مستقلة في الكود المصدري حالياً.

هل يمكن تنفيذ أكثر من إجراء تشغيلي على نفس الضمان؟

وهل يوجد ترتيب إلزامي؟
**إجابة**: يسمح النظام بتنفيذ عدة عمليات (تمديد/تخفيض). لا يوجد ترتيب إلزامي، القيد الوحيد هو أن يكون الضمان في حالة `ready`.

وهل تُمنع الإجراءات بعد التوقيع؟
**إجابة**: نعم، بمجرد وصول الضمان لمرحلة `signed` يتم قفل المسار الإداري.

8️⃣ Dashboard & KPIs

كيف تُحسب القيمة التشغيلية الموفّرة؟

ما هو الـ Baseline؟

هل هي مالية أم زمنية أم كلاهما؟
**إجابة**: كلاهما غير محتسب حالياً برمجياً في الكود؛ الإحصائيات الحالية في `StatsService` تركز على أعداد الضمانات وتوزيعها على الحالات (Stats). حساب القيمة المالية الموفرة يتطلب تعريف معادلة من جهة الأعمال.

ما هو التعريف التجاري لـ First Time Right؟

وما هو المستوى المقبول؟
**إجابة**: تقنياً يتم قياسها بنسبة الضمانات التي تم اعتمادها آلياً بنسبة ثقة عالية دون أي تعديل يدوي من الموظف على المورد أو البنك.

هل لمؤشرات Dashboard:

أي أثر تشغيلي؟
تنبيهات؟
قرارات تلقائية؟
**إجابة**: لا، المؤشرات الحالية هي عرض بصري (Monitoring) فقط. لا توجد تنبيهات تلقائية أو تأثيرات نظامية مرتبطة بهبوط أو ارتفاع المؤشرات في الكود الحالي.

9️⃣ Legal & Compliance

ما هي القيمة القانونية لـ مرحلة التوقيع داخل النظام؟

إجراء داخلي فقط؟
**إجابة**: نعم، هي علامة (Milestone) داخلية تعبر عن اكتمال دورة الموافقات.

أم توقيع معتمد قانونيًا؟
**إجابة**: النظام لا يحتوي على نظام توقيع رقمي (PKI) معتمد قانونياً لخارج النظام حالياً.

كيف يتم التعامل مع الضمانات منتهية الصلاحية؟

State جديد (expired)؟
**إجابة**: لا توجد حالة `expired` في قاعدة البيانات.

أم Indicator فقط؟
**إجابة**: هي مؤشر بصري فقط يتم حسابه بمقارنة تاريخ الصلاحية مع تاريخ اليوم.

10️⃣ Operational & Technical Boundaries

كيف يُدار تعارض التعديلات المتزامنة؟

رفض؟
**إجابة**: النظام يتبع مبدأ "التعديل الأخير يسود" (Last-write wins).

إشعار؟
دمج؟
**إجابة**: لا يوجد إشعار أو دمج آلي في حالة التعديل المتزامن حالياً.

هل توجد حدود حجم/أداء معتمدة رسميًا للنظام؟

عدد ضمانات؟
عدد Events؟
حجم دفعات؟
**إجابة**: الدفعات محددة افتراضياً بـ 500 سجل في المعالجة الآلية الواحدة (`SmartProcessingService::processNewGuarantees`) لضمان استقرار الأداء.
